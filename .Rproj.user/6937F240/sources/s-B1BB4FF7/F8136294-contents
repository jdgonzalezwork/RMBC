#' is_in_gr
#' 
#' Given Y  data  and a set of mixture parameters, this function
#' return a  boolean vector B whose lentght is equal than Y length.
#' B[i] is TRUE if only if Y[i] not belong to the  union of
#' confidence ellipsoids of level given by  the level

#' @param Y A matrix of size n x p.
#' @param theta.mu The estimated centers: A list with K elements, each of them 
#' is an array of length p.
#' @param theta.sigma The estimated scatter matrices: A list with K matrices, each of them 
#' has dimension p x p 
#' @param cutoff   quantiles of chi-square to be used as a threshold for outliers 
#' detection, defaults to 0.999
#' @return A n x K matrix, where each row has the values of the quadratic discriminant 
#' with regarding to the j-th mixture component, j = 1,...,K 
#'
#' @importFrom  stats mahalanobis
#' @importFrom  stats qchisq
#'  
#' @export

is_in_gr=function(Y,cutoff=0.999,theta.mu,theta.sigma){
  Y=as.matrix(Y)
  actualk=length(theta.mu)
  n=dim(Y)[1]; p=dim(Y)[2]
  value=qchisq(cutoff,df=p)
  d=matrix(0,nrow=n,ncol=actualk)
  is_in_gr_out=rep(F,n)
  for (j in 1:length(theta.mu)){
    d[,j]=mahalanobis(x=Y ,center= theta.mu[[j]],cov=MASS::ginv(theta.sigma[[j]]),inverted = TRUE)
  }
  for (i in 1:n){
    is_in_gr_out[i]=any(d[i,]<value)
  }
  is_in_gr_out
}